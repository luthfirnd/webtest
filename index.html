<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="./assets/TVRILogo2019.png">
    <title>Form Reset HP - SDM LPP TVRI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        @font-face {
        font-family: 'Gotham-Light';
        src: url('./assets/Gotham-Light.woff2') format('woff2'); 
        font-weight: 300;
        font-style: normal;
        }


        body {
            font-family: 'Inter';
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 50%, #1d4ed8 100%);
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .form-input:focus {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .submit-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            transition: all 0.3s ease;
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(76, 175, 80, 0.3);
        }
        .submit-btn:disabled {
            background: #cccccc !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }
        .next-btn {
            background: linear-gradient(45deg, #2563eb, #1d4ed8);
            transition: all 0.3s ease;
        }
        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.3);
        }
        .back-btn {
            background: linear-gradient(45deg, #6b7280, #4b5563);
            transition: all 0.3s ease;
        }
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(107, 114, 128, 0.3);
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .success-message {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 500;
        }
        .error-message {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            text-align: center;
            font-weight: 500;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .page-transition {
            transition: all 0.3s ease-in-out;
        }
        #signatureCanvas {
            background: white;
            border: 2px solid #d1d5db;
        }
        .signature-display {
            max-width: 150px;
            max-height: 75px;
            border: 1px solid #ccc;
            background: white;
        }
        .tooltip-container {
            position: relative;
            display: inline-block;
        }
        .tooltip-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            text-align: center;
            line-height: 14px;
            font-size: 12px;
            color: white;
            cursor: help;
            margin-left: 8px;
            vertical-align: middle;
        }
        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            font-weight: normal;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .tooltip-text::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }
        .tooltip-container:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen py-8 px-4">
    <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8">
            <img src="./assets/TVRILogo2019.png" alt="Logo" class="mx-auto w-24 h-auto mb-4" style="filter: drop-shadow(2px 0 white) drop-shadow(-2px 0 white) drop-shadow(0 2px white) drop-shadow(0 -2px white);" />
            <h1 class="text-2xl font-bold text-white mb-2">FORM PENGAJUAN RESET HP</h1>
            <div class="w-40 h-1 bg-white mx-auto rounded-full opacity-80"></div>
        </div>

        <!-- Page 1: Data Diri -->
        <div id="page1" class="page active page-transition">
            <div class="glass-effect rounded-2xl p-8 shadow-2xl">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Data Diri Pegawai</h2>
                    <p class="text-white/80">Silakan lengkapi data diri Anda terlebih dahulu</p>
                </div>

                <form id="dataForm" class="space-y-6">
                    <!-- Nama -->
                    <div class="form-group">
                        <label for="nama" class="block text-white font-medium mb-2">
                            Nama Lengkap
                        </label>
                        <input type="text" id="nama" name="nama" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan nama lengkap">
                    </div>

                    <!-- NIP -->
                    <div class="form-group">
                        <label for="nip" class="block text-white font-medium mb-2">
                            NIP / NI PPPK
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Isi - apabila tidak memiliki NIP</span>
                            </div>
                        </label>
                        <input type="text" id="nip" name="nip" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan NIP">
                    </div>

                    <!-- Jenis Jabatan -->
                    <div class="form-group">
                        <label for="jenisJabatan" class="block text-white font-medium mb-2">Jenis Jabatan</label>
                        <select id="jenisJabatan" name="jenisJabatan" required
                                class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300">
                            <option value="">Pilih Jenis Jabatan</option>
                            <option value="Fungsional">Fungsional</option>
                            <option value="Pelaksana">Pelaksana</option>
                            <option value="Struktural">Struktural</option>
                            <option value="Lainnya">Lainnya</option>
                        </select>
                    </div>

                    <!-- Jabatan -->
                    <div class="form-group">
                        <label for="jabatan" class="block text-white font-medium mb-2">Jabatan</label>
                        <select id="jabatan" name="jabatan" required disabled
                                class="form-input w-full px-4 py-3 rounded-lg border-0 bg-gray-300 text-gray-500 focus:outline-none cursor-not-allowed transition-all duration-300">
                            <option value="">Pilih jenis jabatan terlebih dahulu</option>
                        </select>
                    </div>

                    <!-- Satker -->
                    <div class="form-group">
                        <label for="satker" class="block text-white font-medium mb-2">Satuan Kerja</label>
                        <select id="satker" name="satker" required
                                class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300">
                            <option value="">Pilih Satuan Kerja</option>
                            <option value="Direktorat Keuangan">Direktorat Keuangan</option>
                            <option value="Direktorat Pengembangan dan Usaha">Direktorat Pengembangan dan Usaha</option>
                            <option value="Direktorat Program dan Berita">Direktorat Program dan Berita</option>
                            <option value="Direktorat Teknik">Direktorat Teknik</option>
                            <option value="Direktorat Umum">Direktorat Umum</option>
                            <option value="Pusat Data dan Strategi">Pusat Data dan Strategi</option>
                            <option value="Pusat Pendidikan dan Pelatihan">Pusat Pendidikan dan Pelatihan</option>
                            <option value="Satuan Pengawasan Intern">Satuan Pengawasan Intern</option>
                            <option value="TVRI Stasiun Aceh">TVRI Stasiun Aceh</option>
                            <option value="TVRI Stasiun Bali">TVRI Stasiun Bali</option>
                            <option value="TVRI Stasiun Bangka Belitung">TVRI Stasiun Bangka Belitung</option>
                            <option value="TVRI Stasiun Bengkulu">TVRI Stasiun Bengkulu</option>
                            <option value="TVRI Stasiun D.I. Yogyakarta">TVRI Stasiun D.I. Yogyakarta</option>
                            <option value="TVRI Stasiun DKI Jakarta">TVRI Stasiun DKI Jakarta</option>
                            <option value="TVRI Stasiun Gorontalo">TVRI Stasiun Gorontalo</option>
                            <option value="TVRI Stasiun Jambi">TVRI Stasiun Jambi</option>
                            <option value="TVRI Stasiun Jawa Barat">TVRI Stasiun Jawa Barat</option>
                            <option value="TVRI Stasiun Jawa Tengah">TVRI Stasiun Jawa Tengah</option>
                            <option value="TVRI Stasiun Jawa Timur">TVRI Stasiun Jawa Timur</option>
                            <option value="TVRI Stasiun Kalimantan Barat">TVRI Stasiun Kalimantan Barat</option>
                            <option value="TVRI Stasiun Kalimantan Selatan">TVRI Stasiun Kalimantan Selatan</option>
                            <option value="TVRI Stasiun Kalimantan Tengah">TVRI Stasiun Kalimantan Tengah</option>
                            <option value="TVRI Stasiun Kalimantan Timur">TVRI Stasiun Kalimantan Timur</option>
                            <option value="TVRI Stasiun Kalimantan Utara">TVRI Stasiun Kalimantan Utara</option>
                            <option value="TVRI Stasiun Kepulauan Riau">TVRI Stasiun Kepulauan Riau</option>
                            <option value="TVRI Stasiun Lampung">TVRI Stasiun Lampung</option>
                            <option value="TVRI Stasiun Maluku">TVRI Stasiun Maluku</option>
                            <option value="TVRI Stasiun NTB">TVRI Stasiun NTB</option>
                            <option value="TVRI Stasiun NTT">TVRI Stasiun NTT</option>
                            <option value="TVRI Stasiun Papua">TVRI Stasiun Papua</option>
                            <option value="TVRI Stasiun Papua Barat">TVRI Stasiun Papua Barat</option>
                            <option value="TVRI Stasiun Riau">TVRI Stasiun Riau</option>
                            <option value="TVRI Stasiun Sulawesi Barat">TVRI Stasiun Sulawesi Barat</option>
                            <option value="TVRI Stasiun Sulawesi Selatan">TVRI Stasiun Sulawesi Selatan</option>
                            <option value="TVRI Stasiun Sulawesi Tengah">TVRI Stasiun Sulawesi Tengah</option>
                            <option value="TVRI Stasiun Sulawesi Tenggara">TVRI Stasiun Sulawesi Tenggara</option>
                            <option value="TVRI Stasiun Sulawesi Utara">TVRI Stasiun Sulawesi Utara</option>
                            <option value="TVRI Stasiun Sumatera Barat">TVRI Stasiun Sumatera Barat</option>
                            <option value="TVRI Stasiun Sumatera Selatan">TVRI Stasiun Sumatera Selatan</option>
                            <option value="TVRI Stasiun Sumatera Utara">TVRI Stasiun Sumatera Utara</option>
                        </select>
                    </div>

                    <!-- Nomor HP -->
                    <div class="form-group">
                        <label for="nomorhp" class="block text-white font-medium mb-2">
                            Nomor HP
                        </label>
                        <input type="tel" id="nomorhp" name="nomorhp" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan nomor HP (contoh: 08123456789)">
                    </div>

                    <!-- Tanggal -->
                    <div class="form-group">
                        <label for="tanggal" class="block text-white font-medium mb-2">Tanggal Pengajuan</label>
                        <input type="date" id="tanggal" name="tanggal" required readonly
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-gray-200 text-gray-800 focus:outline-none cursor-not-allowed"
                               title="Tanggal otomatis diisi hari ini">
                    </div>

                    <!-- Device Sebelumnya -->
                    <div class="form-group">
                        <label for="device1" class="block text-white font-medium mb-2">
                            HP Sebelumnya
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Contoh: <br> iOS iPhone 13 <br> Android Samsung S24 </span>
                            </div>
                        </label>
                        <input type="text" id="device1" name="device1" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan nama device sebelumnya">
                    </div>

                    <!-- Device Saat Ini -->
                    <div class="form-group">
                        <label for="device2" class="block text-white font-medium mb-2">
                            HP Saat Ini
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Contoh: <br> Masukkan Jenis HP yang sama dengan kolom sebelumnya apabila HP tidak berubah</span>
                            </div>
                        </label>
                        <input type="text" id="device2" name="device2" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan nama device saat ini">
                    </div>

                    <!-- Kode Error -->
                    <div class="form-group">
                        <label for="errorkode" class="block text-white font-medium mb-2">
                            Kode Error
                            <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Contoh: <br> Masukkan kode error yang muncul pada aplikasi</span>
                            </div>
                        </label>
                        <input type="text" id="errorkode" name="errorkode" required
                               class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300"
                               placeholder="Masukkan kode error yang muncul pada aplikasi">
                    </div>

                    <!-- Alasan -->
                    <div class="form-group">
                        <label for="alasan" class="block text-white font-medium mb-2">
                            Alasan Reset HP
                        </label>
                        <textarea id="alasan" name="alasan" required rows="4"
                                  class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300 resize-none"
                                  placeholder="Masukkan alasan reset gawai"></textarea>
                    </div>

                    <!-- Upload File -->
                    <div class="form-group">
                        <label for="fileUpload" class="block text-white font-medium mb-2">Upload Dokumen Pendukung <span class="text-red-300">*</span>
                        <div class="tooltip-container">
                                <span class="tooltip-icon">i</span>
                                <span class="tooltip-text">Screenshot layar "pesan error" atau bukti dukung lainnya</span>
                            </div>
                        </label>
                        <div class="relative">
                            <input type="file" id="fileUpload" name="fileUpload" accept=".pdf,.jpg,.jpeg,.png" required
                                   class="form-input w-full px-4 py-3 rounded-lg border-0 bg-white/90 text-gray-800 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all duration-300">
                            <p class="text-white/70 text-sm mt-2">Format: PDF, JPG, PNG | Maksimal: 10MB | <strong>Wajib diisi</strong></p>
                        </div>
                        <div id="fileStatus" class="mt-2 text-sm"></div>
                    </div>

                    <!-- Tanda Tangan -->
                    <div class="form-group">
                        <label class="block text-white font-medium mb-2">Tanda Tangan Digital <span class="text-red-300">*</span></label>
                        <div class="bg-white/90 rounded-lg p-4">
                            <canvas id="signatureCanvas" width="500" height="250" 
                                    class="border-2 border-gray-300 rounded cursor-crosshair w-full"
                                    style="max-width: 100%; height: 200px;"></canvas>
                            <div class="flex gap-2 mt-3">
                                <button type="button" id="clearSignature"
                                        class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600 transition-colors">
                                    Hapus
                                </button>
                            </div>
                            <p class="text-gray-600 text-sm mt-2">Gambar tanda tangan Anda di area putih di atas | <strong>Wajib diisi</strong></p>
                        </div>
                    </div>

                    <!-- Next Button -->
                    <div class="form-group pt-4">
                        <button type="button" id="nextBtn"
                                class="next-btn w-full py-4 px-6 rounded-lg text-white font-semibold text-lg shadow-lg">
                            Lanjut ke Surat Pernyataan →
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Page 2: Surat Pernyataan -->
        <div id="page2" class="page page-transition">
            <div class="glass-effect rounded-2xl p-8 shadow-2xl">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Surat Pernyataan</h2>
                    <p class="text-white/80">Silakan baca dan setujui surat pernyataan berikut</p>
                </div>

                <!-- Surat Pernyataan -->
                <div class="bg-white/95 rounded-lg p-8 text-gray-800 text-sm leading-relaxed shadow-lg mb-6">
                    <div class="text-center mb-8">
                        <h3 class="font-bold text-lg text-blue-800 mb-4">SURAT PERNYATAAN RESET/PERUBAHAN GAWAI</h3>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="mb-6">
                            <p class="mb-4">Yang bertanda tangan di bawah ini:</p>
                            <div class="space-y-2">
                                <p>Nama : <span class="font-medium" id="suratNama">-</span></p>
                                <p>NIP : <span class="font-medium" id="suratNip">-</span></p>
                                <p>Jabatan : <span class="font-medium" id="suratJabatan">-</span></p>
                                <p>Satuan Kerja : <span class="font-medium" id="suratSatker">-</span></p>
                                <p>Nomor HP : <span class="font-medium" id="suratNomorhp">-</span></p>
                            </div>
                        </div>
                        
                        <div class="mb-6">
                            <p>Dengan ini mengajukan permohonan perubahan gawai/perangkat dari <span class="font-medium" id="suratDevice1">-</span> menjadi <span class="font-medium" id="suratDevice2">-</span> yang dilakukan untuk menggunakan aplikasi Layanan Kerja. hal ini dikarenakan <span class="font-medium" id="suratAlasan">-</span>.</p>
                        </div>
                        
                        <div class="mb-8">
                            <p>Demikian Surat Pernyataan ini saya buat dengan sesungguhnya, dan apabila dikemudian hari ditemukan bahwa Surat Pernyataan ini tidak benar, maka saya siap menerima sanksi sesuai ketentuan yang berlaku.</p>
                        </div>
                        
                        <div class="flex justify-end mt-12">
                            <div class="text-left">
                                <p class="mb-2"><span class="font-medium" id="suratTanggal">-</span></p>
                                <p class="mb-4">Hormat Saya,</p> 
                                <div class="mb-4">
                                    <img id="signatureDisplay" class="signature-display" style="display: none;" alt="Tanda Tangan">
                                </div>
                                <div>
                                    <p class="font-medium" id="suratNamaTtd">-</p>
                                    <p class="font-medium" id="suratNipTtd">-</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reminder -->
                <div class="bg-yellow-100/20 border border-yellow-300/30 rounded-lg p-4 mb-6">
                    <p class="text-yellow-200 text-center font-medium">
                        Pastikan data diri dan surat pernyataan diatas sudah benar <br>
                        Pilih 'Kembali' jika ada data yang ingin diubah
                    </p>
                </div>

                <!-- Checkbox Setuju -->
                <div class="form-group mb-6">
                    <div class="flex items-start">
                        <input type="checkbox" id="setuju" name="setuju" required
                               class="w-5 h-5 text-blue-600 bg-white/90 border-gray-300 rounded focus:ring-blue-500 focus:ring-2 mt-1">
                        <label for="setuju" class="ml-3 text-white font-medium">
                            Saya telah membaca dan memahami surat pernyataan di atas, serta menyetujui semua ketentuan yang berlaku untuk proses reset gawai ini.
                        </label>
                    </div>
                </div>

                <!-- Buttons -->
                <div class="flex gap-4">
                    <button type="button" id="backBtn"
                            class="back-btn flex-1 py-4 px-6 rounded-lg text-white font-semibold text-lg shadow-lg">
                        ← Kembali
                    </button>
                    <button type="button" id="submitBtn" disabled
                            class="flex-1 py-4 px-6 rounded-lg text-white font-semibold text-lg shadow-lg opacity-50 cursor-not-allowed"
                            style="background: #cccccc;">
                        <span id="submitText">Kirim Formulir</span>
                        <span id="loadingSpinner" class="loading hidden"></span>
                    </button>
                </div>

                <!-- Status Messages -->
                <div id="statusMessage"></div>
            </div>
        </div>

        <!-- Footer -->
        <div class="text-center mt-8">
            <p class="text-white font-semibold text-lg">SDM LPP TVRI</p>
            <p class="text-white font-semibold text-lg">2025</p>
        </div>
    </div>

    <script>
        // Set tanggal hari ini sebagai default
        document.getElementById('tanggal').valueAsDate = new Date();

        // Signature Canvas Setup
        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        let isDrawing = false;
        let signatureData = [];
        let currentStroke = [];

        function getCanvasCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            const ratio = window.devicePixelRatio || 1;
            let clientX, clientY;

            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: (clientX - rect.left) * ratio,
                y: (clientY - rect.top) * ratio
            };
        }



        // Set canvas size properly
        function resizeCanvas() {
            const rect = canvas.getBoundingClientRect();
            const ratio = window.devicePixelRatio || 1;

            canvas.width = rect.width * ratio;
            canvas.height = rect.height * ratio;

            ctx.setTransform(ratio, 0, 0, ratio, 0, 0); 
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;

            redrawSignature(); 
        }


        resizeCanvas();
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(resizeCanvas, 300);
        });

        function redrawSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            signatureData.forEach(stroke => {
                if (stroke.length > 0) {
                ctx.beginPath();
                ctx.moveTo(stroke[0].x, stroke[0].y);
                stroke.forEach(point => {
                    ctx.lineTo(point.x, point.y);
                });
                ctx.stroke();
                }
            });
        }


        function startDrawing(e) {
            isDrawing = true;
            currentStroke = [];
            const rect = canvas.getBoundingClientRect();
            const ratio = window.devicePixelRatio || 1;
            const x = (e.clientX - rect.left) * ratio;
            const y = (e.clientY - rect.top) * ratio;
            ctx.beginPath();
            ctx.moveTo(x, y);
            currentStroke.push({x, y});
        }

        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const ratio = window.devicePixelRatio || 1;
            const x = (e.clientX - rect.left) * ratio;
            const y = (e.clientY - rect.top) * ratio;
            ctx.lineTo(x, y);
            ctx.stroke();
            currentStroke.push({x, y});
        }

        function stopDrawing() {
            if (isDrawing) {
                isDrawing = false;
                signatureData.push([...currentStroke]);
                currentStroke = [];
            }
        }

        // Mouse events for signature
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        // Touch events for mobile
        canvas.addEventListener('touchstart', handleTouch);
        canvas.addEventListener('touchmove', handleTouch);
        canvas.addEventListener('touchend', stopDrawing);

        function handleTouch(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent(e.type === 'touchstart' ? 'mousedown' : 
                                            e.type === 'touchmove' ? 'mousemove' : 'mouseup', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }

        // Clear signature
        document.getElementById('clearSignature').addEventListener('click', function() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            signatureData = [];
        });


        // File upload validation
        document.getElementById('fileUpload').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const fileStatus = document.getElementById('fileStatus');
            
            if (file) {
                const maxSize = 10 * 1024 * 1024; // 10MB
                const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
                
                if (file.size > maxSize) {
                    fileStatus.innerHTML = '<span class="text-red-300">❌ File terlalu besar! Maksimal 10MB</span>';
                    e.target.value = '';
                    return;
                }
                
                if (!allowedTypes.includes(file.type)) {
                    fileStatus.innerHTML = '<span class="text-red-300">❌ Format file tidak didukung! Gunakan PDF, JPG, atau PNG</span>';
                    e.target.value = '';
                    return;
                }
                
                fileStatus.innerHTML = `<span class="text-green-300">✅ File "${file.name}" berhasil dipilih (${(file.size/1024/1024).toFixed(2)} MB)</span>`;
            }
        });

        // Jenis Jabatan dropdown logic
        document.getElementById('jenisJabatan').addEventListener('change', function() {
            const jenisJabatan = this.value;
            const jabatanSelect = document.getElementById('jabatan');
            
            // Clear previous options
            jabatanSelect.innerHTML = '<option value="">Pilih Jabatan</option>';
            
            if (jenisJabatan === '') {
                jabatanSelect.disabled = true;
                jabatanSelect.classList.add('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
                jabatanSelect.classList.remove('bg-white/90', 'text-gray-800');
                jabatanSelect.innerHTML = '<option value="">Pilih jenis jabatan terlebih dahulu</option>';
                return;
            }
            
            // Enable jabatan dropdown
            jabatanSelect.disabled = false;
            jabatanSelect.classList.remove('bg-gray-300', 'text-gray-500', 'cursor-not-allowed');
            jabatanSelect.classList.add('bg-white/90', 'text-gray-800');
            
            // Add options based on jenis jabatan
            let options = [];
            
            if (jenisJabatan === 'Fungsional') {
                options = [
                    'Analis Anggaran Ahli Madya',
                    'Analis Anggaran Ahli Muda',
                    'Analis Anggaran Ahli Pertama',
                    'Analis Hukum Ahli Madya',
                    'Analis Hukum Ahli Muda',
                    'Analis Hukum Ahli Pertama',
                    'Analis Kebijakan Ahli Pertama',
                    'Analis Pengelolaan Keuangan APBN Ahli Madya',
                    'Analis Pengelolaan Keuangan APBN Ahli Muda',
                    'Analis Pengelolaan Keuangan APBN Ahli Pertama',
                    'Analis SDM Aparatur Ahli Madya',
                    'Analis SDM Aparatur Ahli Muda',
                    'Analis SDM Aparatur Ahli Pertama',
                    'Analis SDM Aparatur Ahli Utama',
                    'Apoteker Ahli Pertama',
                    'Arsiparis Ahli Madya',
                    'Arsiparis Ahli Muda',
                    'Arsiparis Ahli Pertama',
                    'Arsiparis Mahir',
                    'Arsiparis Penyelia',
                    'Arsiparis Terampil',
                    'Asesor SDM Aparatur Ahli Madya',
                    'Asesor SDM Aparatur Ahli Muda',
                    'Asesor SDM Aparatur Ahli Pertama',
                    'Asisten Pranata Siaran Mahir',
                    'Asisten Pranata Siaran Pemula',
                    'Asisten Pranata Siaran Penyelia',
                    'Asisten Pranata Siaran Terampil',
                    'Asisten Teknisi Siaran Mahir',
                    'Asisten Teknisi Siaran Pemula',
                    'Asisten Teknisi Siaran Penyelia',
                    'Asisten Teknisi Siaran Terampil',
                    'Auditor Ahli Madya',
                    'Auditor Ahli Muda',
                    'Auditor Ahli Pertama',
                    'Auditor Ahli Utama',
                    'Auditor Terampil',
                    'Dokter Ahli Pertama',
                    'Dokter Gigi Ahli Pertama',
                    'Pengembang Teknologi Pembelajaran Ahli Muda',
                    'Penata Laksana Barang Terampil',
                    'Perancang Peraturan Perundang-Undangan Ahli Madya',
                    'Perancang Peraturan Perundang-Undangan Ahli Muda',
                    'Perancang Peraturan Perundang-Undangan Ahli Pertama',
                    'Perawat Ahli Pertama',
                    'Perencana Ahli Muda',
                    'Perencana Ahli Pertama',
                    'Pranata Hubungan Masyarakat Ahli Madya',
                    'Pranata Hubungan Masyarakat Ahli Muda',
                    'Pranata Hubungan Masyarakat Ahli Pertama',
                    'Pranata Hubungan Masyarakat Mahir',
                    'Pranata Hubungan Masyarakat Penyelia',
                    'Pranata Hubungan Masyarakat Terampil',
                    'Pranata Keuangan APBN Mahir',
                    'Pranata Keuangan APBN Penyelia',
                    'Pranata Keuangan APBN Terampil',
                    'Pranata Komputer Ahli Pertama',
                    'Pranata SDM Aparatur Mahir',
                    'Pranata SDM Aparatur Penyelia',
                    'Pranata SDM Aparatur Terampil',
                    'Pranata Siaran Ahli Madya',
                    'Pranata Siaran Ahli Muda',
                    'Pranata Siaran Ahli Pertama',
                    'Teknisi Siaran Ahli Madya',
                    'Teknisi Siaran Ahli Muda',
                    'Teknisi Siaran Ahli Pertama'
                ];
            } else if (jenisJabatan === 'Pelaksana') {
                options = [
                    'Operator Layanan Operasional',
                    'Penata Acara',
                    'Penata Kelola Pemerintahan',
                    'Penata Layanan Operasional',
                    'Penelaah Teknis Kebijakan',
                    'Pengadministrasi Perkantoran',
                    'Pengelola Keprotokolan',
                    'Pengelola Layanan Operasional',
                    'Pengelola Siaran',
                    'Pengelola Umum Operasional',
                    'Pengolah Data dan Informasi',
                    'Penyusun Materi Hukum dan Perundang-undangan'
                ];
            } else if (jenisJabatan === 'Struktural') {
                options = [
                    'Direktur Keuangan',
                    'Direktur Pengembangan dan Usaha',
                    'Direktur Program dan Berita',
                    'Direktur Teknik',
                    'Direktur Umum',
                    'Direktur Utama',
                    'Kepala Bagian Pengadaan dan Tata Usaha Pimpinan',
                    'Kepala Pusat Pendidikan dan Pelatihan',
                    'Kepala Satuan Pengawasan Intern',
                    'Kepala Sub Bagian Tata Usaha',
                    'Kepala TVRI Stasiun Penyiaran'
                ];
            } else if (jenisJabatan === 'Lainnya') {
                options = [
                    'Non-ASN'
                ];
            }
            
            // Add options to select
            options.forEach(option => {
                const optionElement = document.createElement('option');
                optionElement.value = option;
                optionElement.textContent = option;
                jabatanSelect.appendChild(optionElement);
            });
        });

        // Navigation functions
        function showPage(pageNumber) {
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            document.getElementById(`page${pageNumber}`).classList.add('active');
        }

        // Next button functionality
        document.getElementById('nextBtn').addEventListener('click', function() {
            const form = document.getElementById('dataForm');
            
            // Check signature first (mandatory)
            if (signatureData.length === 0) {
                alert('Tanda tangan digital wajib diisi! Silakan buat tanda tangan terlebih dahulu.');
                return;
            }
            
            if (form.checkValidity()) {
                // Fill the letter with form data
                fillLetter();
                showPage(2);
            } else {
                form.reportValidity();
            }
        });

        // Back button functionality
        document.getElementById('backBtn').addEventListener('click', function() {
            showPage(1);
        });

        // Fill letter with form data
        function fillLetter() {
            const nama = document.getElementById('nama').value;
            const nip = document.getElementById('nip').value;
            const jenisJabatan = document.getElementById('jenisJabatan').value;
            const jabatan = document.getElementById('jabatan').value;
            const satker = document.getElementById('satker').value;
            const nomorhp = document.getElementById('nomorhp').value;
            const tanggal = document.getElementById('tanggal').value;
            const device1 = document.getElementById('device1').value;
            const device2 = document.getElementById('device2').value;
            const alasan = document.getElementById('alasan').value;

            // Format tanggal
            const dateObj = new Date(tanggal);
            const formattedDate = dateObj.toLocaleDateString('id-ID', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            // Fill letter fields
            document.getElementById('suratNama').textContent = nama;
            document.getElementById('suratNip').textContent = nip;
            document.getElementById('suratJabatan').textContent = jabatan;
            document.getElementById('suratSatker').textContent = satker;
            document.getElementById('suratNomorhp').textContent = nomorhp;
            document.getElementById('suratTanggal').textContent = formattedDate;
            document.getElementById('suratDevice1').textContent = device1;
            document.getElementById('suratDevice2').textContent = device2;
            document.getElementById('suratAlasan').textContent = alasan;
            document.getElementById('suratNamaTtd').textContent = nama;
            document.getElementById('suratNipTtd').textContent = nip;

            // Display signature
            const signatureDisplay = document.getElementById('signatureDisplay');
            if (signatureData.length > 0) {
                signatureDisplay.src = canvas.toDataURL();
                signatureDisplay.style.display = 'block';
            }

            // PENTING: Reset checkbox dan disable tombol submit saat pindah ke halaman 2
            document.getElementById('setuju').checked = false;
            checkSubmitButton();
        }

        // Function to check if submit button should be enabled
        function checkSubmitButton() {
            const setujuCheckbox = document.getElementById('setuju');
            const submitBtn = document.getElementById('submitBtn');
            
            if (setujuCheckbox.checked) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.add('submit-btn');
                submitBtn.style.background = 'linear-gradient(45deg, #4CAF50, #45a049)';
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.remove('submit-btn');
                submitBtn.style.background = '#cccccc';
            }
        }

        // Add event listener to checkbox
        document.getElementById('setuju').addEventListener('change', checkSubmitButton);

        // Function to convert file to base64
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Add KOTA Variable
        const SATKER_KOTA = {
            'Direktorat Keuangan': 'Jakarta',
            'Direktorat Pengembangan dan Usaha': 'Jakarta',
            'Direktorat Program dan Berita': 'Jakarta',
            'Direktorat Teknik': 'Jakarta',
            'Direktorat Umum': 'Jakarta',
            'Pusat Data dan Strategi': 'Jakarta',
            'Pusat Pendidikan dan Pelatihan': 'Jakarta',
            'Satuan Pengawasan Intern': 'Jakarta',
            'TVRI Stasiun Aceh': 'Aceh',
            'TVRI Stasiun Bali': 'Bali',
            'TVRI Stasiun Bangka Belitung': 'Bangka Belitung',
            'TVRI Stasiun Bengkulu': 'Bengkulu',
            'TVRI Stasiun D.I. Yogyakarta': 'Yogyakarta',
            'TVRI Stasiun DKI Jakarta': 'Jakarta',
            'TVRI Stasiun Gorontalo': 'Gorontalo',
            'TVRI Stasiun Jambi': 'Jambi',
            'TVRI Stasiun Jawa Barat': 'Bandung',
            'TVRI Stasiun Jawa Tengah': 'Semarang',
            'TVRI Stasiun Jawa Timur': 'Surabaya',
            'TVRI Stasiun Kalimantan Barat': 'Pontianak',
            'TVRI Stasiun Kalimantan Selatan': 'Banjarmasin',
            'TVRI Stasiun Kalimantan Tengah': 'Palangkaraya',
            'TVRI Stasiun Kalimantan Timur': 'Samarinda',
            'TVRI Stasiun Kalimantan Utara': 'Tanjung Selor',
            'TVRI Stasiun Kepulauan Riau': 'Tanjung Pinang',
            'TVRI Stasiun Lampung': 'Lampung',
            'TVRI Stasiun Maluku': 'Maluku',
            'TVRI Stasiun NTB': 'Mataram',
            'TVRI Stasiun NTT': 'Kupang',
            'TVRI Stasiun Papua': 'Jayapura',
            'TVRI Stasiun Papua Barat': 'Manokwari',
            'TVRI Stasiun Riau': 'Pekanbaru',
            'TVRI Stasiun Sulawesi Barat': 'Mamuju',
            'TVRI Stasiun Sulawesi Selatan': 'Makassar',
            'TVRI Stasiun Sulawesi Tengah': 'Palu',
            'TVRI Stasiun Sulawesi Tenggara': 'Kendari',
            'TVRI Stasiun Sulawesi Utara': 'Manado',
            'TVRI Stasiun Sumatera Barat': 'Padang',
            'TVRI Stasiun Sumatera Selatan': 'Palembang',
            'TVRI Stasiun Sumatera Utara': 'Medan'
            };

            function getKotaBySatker(satker) {
            return SATKER_KOTA[satker] || '-';
            }

        // Function to generate PDF from the letter (GANTI FUNGSI INI DI HTML)
        async function generatePDF() {
            return new Promise((resolve) => {
                // Create a temporary container for PDF generation
                const pdfContainer = document.createElement('div');
                pdfContainer.style.cssText = `
                    position: absolute;
                    top: -9999px;
                    left: -9999px;
                    width: 180mm;
                    background: white;
                    padding: 15mm;
                    font-family: 'Gotham-Light';
                    font-size: 11pt;
                    font-weight: 300;
                    line-height: 1.5;
                    color: black;
                `;

                // Get form data
                const nama = document.getElementById('nama').value;
                const nip = document.getElementById('nip').value;
                const jenisJabatan = document.getElementById('jenisJabatan').value;
                const jabatan = document.getElementById('jabatan').value;
                const satker = document.getElementById('satker').value;
                const nomorhp = document.getElementById('nomorhp').value;
                const tanggal = document.getElementById('tanggal').value;
                const device1 = document.getElementById('device1').value;
                const device2 = document.getElementById('device2').value;
                const alasan = document.getElementById('alasan').value;
                const kotaSatker = getKotaBySatker(satker);

                // Format tanggal
                const dateObj = new Date(tanggal);
                const formattedDate = dateObj.toLocaleDateString('id-ID', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });

                // Create letter HTML with proper Gotham Light font
                pdfContainer.innerHTML = `
                    <div style="text-align: center; margin-bottom: 30px;">
                        <h2 style="margin: 0; font-size: 10pt; font-family: 'Gotham-Light';">SURAT PERNYATAAN RESET/PERUBAHAN GAWAI</h2>
                    </div>
                    <br>
                    <div style="margin-bottom: 20px;">
                        <p style="margin-bottom: 15px; font-family: 'Gotham-Light'; font-size: 11pt; font-weight: 300;">Yang bertanda tangan di bawah ini:</p>
                        <div style="margin-left: 20px; margin-bottom: 20px;">
                            <table style="border-collapse: collapse; font-family: 'Gotham-Light'; font-size: 10pt;">
                                <tr><td style="padding: 3px 0; width: 120px; font-weight: 300;">Nama</td><td style="padding: 3px 0; width: 20px; font-weight: 300;">:</td><td style="padding: 3px 0; font-weight: 300;">${nama}</td></tr>
                                <tr><td style="padding: 3px 0; font-weight: 300;">NIP</td><td style="padding: 3px 0; font-weight: 300;">:</td><td style="padding: 3px 0; font-weight: 300;">${nip}</td></tr>
                                <tr><td style="padding: 3px 0; font-weight: 300;">Jabatan</td><td style="padding: 3px 0; font-weight: 300;">:</td><td style="padding: 3px 0; font-weight: 300;">${jabatan}</td></tr>
                                <tr><td style="padding: 3px 0; font-weight: 300;">Satuan Kerja</td><td style="padding: 3px 0; font-weight: 300;">:</td><td style="padding: 3px 0; font-weight: 300;">${satker}</td></tr>
                                <tr><td style="padding: 3px 0; font-weight: 300;">Nomor HP</td><td style="padding: 3px 0; font-weight: 300;">:</td><td style="padding: 3px 0; font-weight: 300;">${nomorhp}</td></tr>
                            </table>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <p style="text-align: justify; font-family: 'Gotham-Light'; font-size: 10pt; font-weight: 300;">Dengan ini mengajukan permohonan perubahan gawai/perangkat dari <strong style="font-weight: bold;">${device1}</strong> menjadi <strong style="font-weight: bold;">${device2}</strong> yang dilakukan untuk menggunakan aplikasi Layanan Kerja. hal ini dikarenakan <strong style="font-weight: bold;">${alasan}</strong>.</p>
                    </div>
                    
                    <div style="margin-bottom: 40px;">
                        <p style="text-align: justify; font-family: 'Gotham-Light'; font-size: 10pt; font-weight: 300;">Demikian Surat Pernyataan ini saya buat dengan sesungguhnya, dan apabila dikemudian hari ditemukan bahwa Surat Pernyataan ini tidak benar, maka saya siap menerima sanksi sesuai ketentuan yang berlaku.</p>
                    </div>
                    
                    <div style="text-align: right; margin-top: 40px;">
                        <div style="display: inline-block; text-align: left;">
                            <p style="margin: 5px 0; font-family: 'Gotham-Light'; font-size: 10pt; font-weight: 300;">${kotaSatker}, ${formattedDate}</p>
                            <p style="margin: 5px 0 20px 0; font-family: 'Gotham-Light'; font-size: 10pt; font-weight: 300;">Hormat Saya,</p>
                            <div style="margin: 20px 0; height: 120px; display: flex; align-items: center; justify-content: center;">
                                <img src="${canvas.toDataURL()}" style="max-width: 180px; max-height: 100px; width: auto; height: auto;" alt="Tanda Tangan">
                            </div>
                            <div>
                                <p style="margin: 5px 0; font-weight: 300; font-family: 'Gotham-Light'; font-size: 10pt;">${nama}</p>
                                <p style="margin: 5px 0; font-weight: 300; font-family: 'Gotham-Light'; font-size: 10pt;">${nip}</p>
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(pdfContainer);

                // Use html2canvas to convert to image, then to PDF
                html2canvas(pdfContainer, {
                    scale: 2.0,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: pdfContainer.offsetWidth,
                    height: pdfContainer.offsetHeight
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 0.85);
                    
                    // Create PDF using jsPDF
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4', true);
                    
                    const imgWidth = 180;
                    const pageHeight = 250;
                    const imgHeight = (canvas.height * imgWidth) / canvas.width;
                    let heightLeft = imgHeight;
                    let position = 10;

                    pdf.addImage(imgData, 'JPEG', 15, position, imgWidth, imgHeight, undefined, 'FAST');
                    heightLeft -= pageHeight;

                    while (heightLeft >= 0) {
                        position = heightLeft - imgHeight;
                        pdf.addPage();
                        pdf.addImage(imgData, 'JPEG', 15, position, imgWidth, imgHeight, undefined, 'FAST');
                        heightLeft -= pageHeight;
                    }

                    document.body.removeChild(pdfContainer);
                    resolve(pdf.output('datauristring'));
                });
            });
        }

        // Handle form submission
        document.getElementById('submitBtn').addEventListener('click', async function() {
            const submitBtn = document.getElementById('submitBtn');
            const submitText = document.getElementById('submitText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const statusMessage = document.getElementById('statusMessage');
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitText.textContent = 'Mengirim Formulir...';
            loadingSpinner.classList.remove('hidden');
            statusMessage.innerHTML = '';
            
            try {
                // Prepare all data
                const basicData = {
                    timestamp: new Date().toLocaleString('id-ID'),
                    nama: document.getElementById('nama').value,
                    nip: document.getElementById('nip').value,
                    jenisJabatan: document.getElementById('jenisJabatan').value,
                    jabatan: document.getElementById('jabatan').value,
                    satker: document.getElementById('satker').value,
                    nomorhp: document.getElementById('nomorhp').value,
                    tanggal: document.getElementById('tanggal').value,
                    device1: document.getElementById('device1').value,
                    device2: document.getElementById('device2').value,
                    errorkode: document.getElementById('errorkode').value,
                    alasan: document.getElementById('alasan').value,
                    setuju: document.getElementById('setuju').checked ? 'Ya' : 'Tidak'
                };

                // Generate PDF
                const pdfData = await generatePDF();

                // Prepare file data (if any)
                let fileData = null;
                let fileName = null;
                let fileType = null;
                
                const fileInput = document.getElementById('fileUpload');
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    fileData = await fileToBase64(file);
                    fileName = file.name;
                    fileType = file.type;
                }

                // Send all data in one request
                const allData = {
                    ...basicData,
                    pdfData: pdfData,
                    fileData: fileData,
                    fileName: fileName,
                    fileType: fileType
                };

                // Send data to Google Apps Script
                const response = await fetch('https://script.google.com/macros/s/AKfycbycdtiDz4J3mNvKTLkBkYWH0TQ6kvUiwPgB_kfc1Ec1v7s7nAXHnFUbu_wMNATDlYQf/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(allData)
                });

                statusMessage.innerHTML = '<div class="success-message">✅ Data berhasil dikirim dan telah tersimpan!</div>';
                
                // Reset forms and go back to page 1
                setTimeout(() => {
                    document.getElementById('dataForm').reset();
                    document.getElementById('tanggal').valueAsDate = new Date();
                    document.getElementById('setuju').checked = false;
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    signatureData = [];
                    document.getElementById('fileStatus').innerHTML = '';
                    showPage(1);
                    statusMessage.innerHTML = '';
                }, 5000);
                
            } catch (error) {
                console.error('Error:', error);
                statusMessage.innerHTML = '<div class="error-message">❌ Gagal memproses data. Error: ' + error.message + '</div>';
            }
            
            // Reset button
            submitBtn.disabled = false;
            submitText.textContent = 'Kirim Formulir';
            loadingSpinner.classList.add('hidden');
            checkSubmitButton();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97f65b1b428ff44c',t:'MTc1NzkyMDc2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
